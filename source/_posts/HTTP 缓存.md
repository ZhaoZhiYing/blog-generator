---
title: HTTP 缓存
date: 2018-03-03 19:53:51
categories: HTTP
tags:
---


#### `Cache-Control`

`Cache-Control`通用消息头被用于在 `HTTP` 请求和响应中通过指定指令来实现缓存机制。

**注意：**	首页不要设置缓存


##### 如何使`css` `js` 加载速度加快？

举例 `node.js`

	response.setHeader('Cache-Control', 'max-age=30') 
	// 表示当访问此网页后的 30s 内再次访问不会向服务器发起请求

##### 如何更新缓存？

1. 加版本号
2. 更改 `HTML` 的 `URL`，跟之前不一样即可，比如加个随机数。

---

#### `Expire`

##### `Expire` 和 `Cache-Control` 区别?

	* Expire 是指定了一个时间，在这个时间之后，HTTP 响应就过期。
	* Cache-Control 是指定一个时间范围，超过这个时间范围，HTTP 响应就过期。
	* Expire 是旧版缓存设置方法，Cache-Control 是新版缓存机制设置方法。

>如果还有一个设置了 "max-age" 或者 "s-max-age" 指令的 Cache-Control 响应头，那么 Expires 头就会被忽略。	

##### 为什么优先使用 `Cache-Control`?	

因为 `Expire` 指定的时间（日期/时间）指本地时间，如果用户的时间错乱，就会出问题。

---

### `ETag`

#### `MD5`

	* MD5 是一个摘要算法。将一个字符串，或文件，或压缩包，执行 MD5 后，就可以生成一个固定长度为 128bit 的串。如果有人修改过压缩包后，就会生成新的串。
	* 目的是检查报文主体在传输过程中是否保持完整，以及确认传输到达。为确保报文的有效性，接收方的客户端会对报文主体再执行一次相同的 MD5算法。计算出的值与字段值作比较后，即可判断出报文主体的准确性。
	* MD5 的长度默认为 128bit，也就是 128个0和1 的二进制串。将二进制转成 16进制，每 4个bit 表示一个 16进制，所以 128/4 = 32 换成 16进制 表示后，为 32位。
	* MD5 最大的特点：如果内容的差异越小，算出的结果差异越大。
	* MD5 会被保存在文件的 ETag 里。

如下图

<img src="https://i.loli.net/2018/03/03/5a9ac12bcba07.png
">

#### `ETag`
	
当一个 `URL` 被请求，服务器会返回资源和其相应的`ETag`值，它会被放置在`HTTP`的`ETag`字段中：

	ETag: "686897696a7c876b7e"
	
以后，如果客户端想再次请求相同的`URL`，将会发送一个包含已保存的`ETag`和`If-None-Match`字段的请求。

	If-None-Match: "686897696a7c876b7e"
	
客户端请求之后，服务器会比较客户端的`ETag`和当前版本资源的`ETag`。如果`ETag`值匹配，则意味着资源没有改变，服务器会返回`HTTP 304`的状态码。

如果`ETag`的值不匹配，这就意味着资源很可能发生了变化，那么，一个完整的响应就会被返回。

#### `last-Modified`

**由于精确度比 `ETag` 要低，所以这是一个备用机制。**

在浏览器第一次请求某一个 `URL` 时，服务器端的返回状态会是`200`，内容是你请求的资源，同时有一个 `Last-Modified` 的属性标记此文件在服务端最后被修改的时间，格式类似这样：

	Last-Modified: Mon, 30 Nov 2015 23:21:37 GMT
	
浏览器第二次请求此 `URL` 时，根据 `HTTP` 协议的规定，浏览器会向服务器传送 `If-Modified-Since` 报头，询问该时间之后文件是否有被修改过：

	If-Modified-Since: Mon, 30 Nov 2015 23:21:37 GMT
	
如果服务器端的资源没有变化，则自动返回 `HTTP 304` 状态码，内容为空，这样就节省了传输数据量。

##### `ETag` 和 `Cache-Control` 区别

`Cache-Control`是直接不请求。`ETag`是请求但响应体是空的。

---



