---
title: 实现两个 jQuery 的 API
date: 2017-12-18 14:28:38
tags:
---
### getSiblings

##### 实现第一个 API：`getSiblings`获取一个节点的所有兄弟节点


	<ul>
		<li id="item1">选项1</li>
		<li id="item1">选项2</li>
		<li id="item1">选项3</li>
		<li id="item1">选项4</li>
		<li id="item1">选项5</li>
	</ul>

定义一个伪数组 `array`，然后遍历伪数组，将`!== item3`的节点放进这个伪数组，最后得到这个节点的所有兄弟节点。

	var allChildren = item3.parentNode.children 
	var array = { 
		length:0
	}
	for(let i = 0; i<allChildren.length; i++){
		if (allChildren[i] !== item3){
			array[array.length] = allChildren[i]
			array.length += 1
		}
	}
	
封装成函数

	function getSiblings(node){
		var allChildren = node.parentNode.children 
		var array = { 
			length:0
		}
		for(let i = 0; i<allChildren.length; i++){
			if (allChildren[i] !== node){
				array[array.length] = allChildren[i]
				array.length += 1
			}
		}
		return array
	}
	getSiblings.call(item3)//调用
	
### addClass	

##### 实现第二个 API：`addClass`为元素添加指定的样式类名

	item3.classList.add('a')
	item3.classList.add('b')
	item3.classList.add('c')
	
上面代码优化后如下（这里用到了箭头函数）

	var classes = {'a':true, 'b':true, 'c':false,}
	classes.forEach((value) => item3.classList.add(value))
	
加上`remove`

	var classes = {'a':true, 'b':true, 'c':false,}
	for(let key in classes){
		var value = classes[key]
		if(value){
			item3.classList.add(key)
		}else{
			item3.classList.remove(key)
		}
	}
	
封装成函数

	function addClass(node,classes){
		for(let key in classes){
			var value = classes[key]
			if(value){
				node.classList.add(key)
			}else{
				node.classList.remove(key)
			}
		}	
	}	
	addClass.call(item3,{'a':true, 'b':true, 'c':false,})//调用
	
优化代码（这里用到了三元运算符）

	function addClass(node,classes){
		for(let key in classes){
			var value = classes[key]
			var methodName = value ？'add' : 'remove'
				node.classList[methodName](key)
		}	
	}	
	addClass.call(item3,{'a':true, 'b':true, 'c':false,})//调用
	
上面代码等于下面

	function addClass(node,classes){
		classes.forEach((value) => node.classList.add(value))
	}	
	addClass.call(item3,['a','b','c'])//调用
		
上面两个 API 的弊端：如果有人已经定义过getSiblings ，会被这次覆盖。而且不方便调用。运用 **命名空间** 能解决这个问题。

	window.zzdom = {} //声明变量名 zzdom
	zzdom.getSiblings = getSiblings 
	zzdom.addClass = addClass
	//调用
	zzdom.getSiblings.call(item3)  
	zzdom.addClass.call(items, {a:true, b:false, c:true})	
代码更新如下

	window.zzdom = {}		
	zzdom.getSiblings = function (node){ 
	var allChildren = node.parentNode.children 
	var array = { 
		length:0
	}
	for(let i = 0; i<allChildren.length; i++){
		if (allChildren[i] !== node){
			array[array.length] = allChildren[i]
			array.length += 1
		}
	}
	return array
	}
	
	zzdom.addClass = function (node,classes){
		classes.forEach((value) => node.classList.add(value))
	}
	//调用
	zzdom.getSiblings.call(item3)
	zzdom.addClass.call(item3,['a','b','c'])
	
但是相比下，下面这种调用方法更好

	//调用
	item3.getSiblings.call(item3)
	item3.addClass.call(item3,['a','b','c'])
	
故更改如下：

	Node.prototype.getSiblings = function (){ 
	var allChildren = this.parentNode.children 
	var array = { 
		length:0
	}
	for(let i = 0; i<allChildren.length; i++){
		if (allChildren[i] !== this){
			array[array.length] = allChildren[i]
			array.length += 1
		}
	}
	return array
	}
	
	Node.prototype.addClass = function (classes){
		classes.forEach((value) => this.classList.add(value))
	}
	//调用
	zzdom.getSiblings.call(item3)
	zzdom.addClass.call(item3,['a','b','c'])

> 注意：上面代码更改了`node`的公有属性。`this`是调用函数时的第一个参数。

上面代码弊端：如果之前声明过`getSiblings`和`addClass`，会被这次声明覆盖。
那么不更改原型，解决办法如下：

	window.jQuery = function (node){
		return{
			Node.prototype.getSiblings = function (){ 
			var allChildren = this.parentNode.children 
			var array = { 
				length:0
			}
			for(let i = 0; i<allChildren.length; i++){
				if (allChildren[i] !== this){
					array[array.length] = allChildren[i]
					array.length += 1
				}
			}
			return array
			}
			
			Node.prototype.addClass = function (classes){
				classes.forEach((value) => this.classList.add(value))
			}
		}
	}
	//调用
	var node2 = jQuery(item3)
	node2.getSiblings.call(item3)
	node2.addClass.call(item3,['a','b','c'])
	
增加类型检测：字符串`string`或选择器`selector`

	window.jQuery = function (nodeOrSelector){
		let node
		if(typeof nodeOrSelector === 'string'){
			node = document.querySelsctor(nodeOrSelector)
		}else{
			node = nodeOrSelector
		}
		
		return{
			Node.prototype.getSiblings = function (){ 
			var allChildren = this.parentNode.children 
			var array = { 
				length:0
			}
			for(let i = 0; i<allChildren.length; i++){
				if (allChildren[i] !== this){
					array[array.length] = allChildren[i]
					array.length += 1
				}
			}
			return array
			}
			
			Node.prototype.addClass = function (classes){
				classes.forEach((value) => this.classList.add(value))
			}
		}
	}
	//调用
	var node2 = jQuery(item3)
	node2.getSiblings.call(item3)
	node2.addClass.call(item3,['a','b','c'])
	

	
		
	
	


		
			
		
	
	
	
	
